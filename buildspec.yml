version: 0.2

phases:
  install:
    commands:
      - export IMAGE_TAG=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
      - export ACCOUNT=$(echo $CODEBUILD_BUILD_ARN |cut -f5 -d:)
      - echo '***** This is the current env:'
      - printenv
      - ls -lah
      - pwd

  build:
    commands:
      - mkdir -p themes/learn
      - git clone https://github.com/matcornic/hugo-theme-learn.git themes/learn
      - echo "<p class="build-number">${IMAGE_TAG}</p>" >> layouts/partials/menu-footer.html
      - npm install
      - npm run build
      - npm run deploycontent
      - npm run deployothers

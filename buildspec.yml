version: 0.2

phases:
  install:
    commands:
      - export IMAGE_TAG=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)
      - export ACCOUNT=$(echo $CODEBUILD_BUILD_ARN |cut -f5 -d:)
      - echo '***** This is the current env:'
      - printenv
      - ls -lah
      - pwd
  build:
    commands:
      - wget https://github.com/gohugoio/hugo/releases/download/v0.36/hugo_0.36_Linux-64bit.deb
      - dpkg -i hugo*.deb
      - hugo version
      - mkdir workspace; cd workspace
      - git clone https://github.com/brentley/ecsworkshop.git
      - cd ecsworkshop/
      - git submodule update --init --recursive
      - npm install
      - npm run build
      - npm run deploy
